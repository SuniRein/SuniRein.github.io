import{_ as e,c as t,e as i,b as n,r as h,o as l}from"./app-C-DIM9nL.js";const k={};function p(r,s){const a=h("Mermaid");return l(),t("div",null,[s[0]||(s[0]=i(`<p>JWT，全称 <em>JSON Web Token</em>，是一种使用加密签名保护的 JSON 数据，定义在 <a href="https://www.rfc-editor.org/rfc/rfc7519" target="_blank" rel="noopener noreferrer">RFC 7519</a> 中。 它通常用于 Web 应用和 API 中，用于验证用户身份，防止未经授权的访问。</p><p>与传统服务端 Session 不同，JWT 是无状态的，服务端无需存储会话信息，因此非常适合分布式系统和微服务架构。</p><h2 id="jwt-的结构" tabindex="-1"><a class="header-anchor" href="#jwt-的结构"><span>JWT 的结构</span></a></h2><p>JWT 主要由三部分构成，每部分均采用 <code>Base64</code> 编码存储，中间用 <code>.</code> 分隔：</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>Header.Payload.Signature</span></span></code></pre></div><ol><li><em>Header</em>：包含 Token 的元数据，例如用于签名的算法。</li><li><em>Payload</em>：存储声明，例如用户的身份和权限、Token 过期时间等。</li><li><em>Signature</em>：使用密码加密后得到的签名，用于保证数据的真实性和完整性。</li></ol><p>可以在 <a href="https://www.jwt.io" target="_blank" rel="noopener noreferrer">JWT Debugger</a> 中在线尝试下 JWT 的编解码过程。</p><h3 id="header" tabindex="-1"><a class="header-anchor" href="#header"><span>Header</span></a></h3><p>Header 中存储了 Token 的元数据，包括签名算法和令牌类型：</p><div class="language-json" data-highlighter="shiki" data-ext="json" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">alg</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">HS256</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">typ</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">JWT</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><ul><li><code>alg</code>：指定签名算法。常用： <ul><li><code>HS256</code>（HMAC + SHA-256）：对称加密算法，兼顾效率与安全性，适合小项目。</li><li><code>RS256</code>（RSA + SHA-256）或 <code>ES256</code>（ECDSA + SHA-256）：非对称加密，适合高安全需求。</li></ul></li><li><code>typ</code>：指定类型，一般设置为 <code>JWT</code>，应用程序可通过该项来区分不同类型的对象。</li></ul><h3 id="payload" tabindex="-1"><a class="header-anchor" href="#payload"><span>Payload</span></a></h3><p>Payload 中可以存储任意字段，供服务端获取用户身份、检验用户权限等需求：</p><div class="language-json" data-highlighter="shiki" data-ext="json" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">sub</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 328913</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">aud</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">web</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">role</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">admin</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">exp</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1733631682</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><p>此外，RFC 7519 中定义了一些<strong>标准字段</strong>，推荐使用但不强制：</p><table><thead><tr><th>字段</th><th>全称</th><th>含义</th></tr></thead><tbody><tr><td><strong>iss</strong></td><td>issuer</td><td>签发者标识。通常是系统名、域名或服务名称。</td></tr><tr><td><strong>sub</strong></td><td>subject</td><td>主题，一般用于用户唯一标识（user ID）。</td></tr><tr><td><strong>aud</strong></td><td>audience</td><td>令牌的接收方，例如 <code>web</code> <code>mobile</code> <code>api</code>。</td></tr><tr><td><strong>exp</strong></td><td>expiration time</td><td>过期时间（Unix 时间戳）。必须大于当前时间。</td></tr><tr><td><strong>nbf</strong></td><td>not before</td><td>起始生效时间。例如 Token 10 秒后才生效。</td></tr><tr><td><strong>iat</strong></td><td>issued at</td><td>签发时间（Unix 时间戳）。</td></tr><tr><td><strong>jti</strong></td><td>JWT ID</td><td>用作令牌的唯一标识，可用于黑名单等场景。</td></tr></tbody></table><div class="hint-container warning"><p class="hint-container-title">不要存储敏感信息</p><p>Payload 仅通过 Base64 编码，未被加密，可直接解码，不适合存储敏感信息。</p></div><h3 id="signature" tabindex="-1"><a class="header-anchor" href="#signature"><span>Signature</span></a></h3><p>签名用于保证 Token 的真实性与完整性，它使用 Header、Payload 和密钥生成：</p><div class="language-js" data-highlighter="shiki" data-ext="js" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-js"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">HMACSHA256</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  base64UrlEncode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">header</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> +</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> +</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> base64UrlEncode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">payload</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  secret</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre></div><p>密钥仅在服务端存储，不能泄露。</p><h2 id="jwt-的工作流程" tabindex="-1"><a class="header-anchor" href="#jwt-的工作流程"><span>JWT 的工作流程</span></a></h2><ol><li><strong>登录请求</strong>：用户通过客户端向服务端发送身份凭据（如用户名和密码）用于登录。</li><li><strong>生成 JWT</strong>：服务端验证用户发送的身份凭据，如果凭据正确，将使用密钥生成 JWT。</li><li><strong>返回 JWT</strong>：服务端将 JWT 发送给客户端。</li><li><strong>后续请求附带 JWT</strong>：对于任何后续请求，客户端将随请求一起发送 JWT。 服务器在处理请求前会验证 JWT，如验证签名、判断是否过期、验证权限等。</li></ol>`,23)),n(a,{code:"eJyVkctOwlAURed+xf0BI0ZGDJjoyKkaxw3emCbYYKmORVGKsVDTEoMiYALGmAAhkUDKw5/hPhjxC96HmBJaox21J/ucvbtXGp6eQS0Bd1TlWFdO1gB7UopuqAk1pWgGOEhDfWW4nVShZqyM96B+ztRizvfAejz+rY0BOnHQdZO4b9jsI9uaDgqoc0PqGaGWIqGXR2IAFe9nFxlSHqJxiXb6uHs5H5ko18JWez7KSxOpXVrD9ZfZ+53UCY2SNID8xA91XDLF0L+8FPLTRU9VEI1sAumMGl360fzZWeTkO/wPY0syXLRJwxNimEzDhW0lH2Try0zcGjZtsHu4/5dwfllYHnYO3dZkEu0ohAhrmPYYiwIZtrBjTceVMBbY9tDglTsD8piVNEIJsPppJ8PFDBhpTRhssMHC53Clxl7w89WsbHOECzr87L/YbEQjW79UQNsNFiAYifAKBrLqRXtZ7NksM3Is5Lm+UoONUbfEzMjQwVVZJe/+C54+YtI="}),s[1]||(s[1]=i(`<h2 id="jwt-的传输" tabindex="-1"><a class="header-anchor" href="#jwt-的传输"><span>JWT 的传输</span></a></h2><h3 id="使用-http-头" tabindex="-1"><a class="header-anchor" href="#使用-http-头"><span>使用 HTTP 头</span></a></h3><p>服务端通过 HTTP 响应体返回相应的 Token：</p><div class="language-json" data-highlighter="shiki" data-ext="json" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">access_token</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&lt;JWT_ACCESS&gt;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">refresh_token</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&lt;JWT_REFRESH&gt;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><p>客户端将 Token 存储在 localStorage 或 sessionStorage 中，在后续请求中通过 <code>Authorization</code> 头传递：</p><div class="language-http" data-highlighter="shiki" data-ext="http" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-http"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">GET</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> /api/profile</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Authorization:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Bearer &lt;JWT_ACCESS&gt;</span></span></code></pre></div><p>这种方式简单直观，可以提供较高的灵活性，但是存储在 localStorage 或 sessionStorage 中容易受 XSS 攻击。</p><h3 id="使用-cookie" tabindex="-1"><a class="header-anchor" href="#使用-cookie"><span>使用 Cookie</span></a></h3><p>服务端通过 <code>Set-Cookie</code> 头同时传递 JWT <code>access_token</code> 和 <code>refresh_token</code>：</p><div class="language-http" data-highlighter="shiki" data-ext="http" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-http"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">HTTP</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">2.0</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 200</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> OK</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Set-Cookie:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> access_token=&lt;JWT_ACCESS&gt;; HttpOnly; Secure; SameSite=Strict; Path=/; Max-Age=900</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">Set-Cookie:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> refresh_token=&lt;JWT_REFRESH&gt;; HttpOnly; Secure; SameSite=Strict; Path=/refresh; Max-Age=604800</span></span></code></pre></div><div class="hint-container warning"><p class="hint-container-title">安全提示</p><p>Cookie 配合 <code>HttpOnly</code> + <code>Secure</code> + <code>SameSite</code> 能防止 XSS 与部分 CSRF 攻击。</p><p><code>refresh_token</code> 仅允许在 <code>/refresh</code> API 中使用，降低泄露风险。</p></div><p>客户端在发起 HTTP 请求时会自动携带相应的 Cookie，无需手动传递。</p><h2 id="安全使用-jwt" tabindex="-1"><a class="header-anchor" href="#安全使用-jwt"><span>安全使用 JWT</span></a></h2><ol><li><strong>选择安全的加密算法</strong>：对于普通项目，建议采用 <code>HS256</code>，有更高安全性需求可以使用 <code>RS256</code> 或 <code>ES256</code> 等非对称加密算法。</li><li><strong>保护密钥安全</strong>：密钥不要硬编码在客户端或前端，可使用环境变量或安全存储来管理密钥，并定期轮换。</li><li><strong>控制 Token 生命周期</strong>：JWT 一旦签发，通常无法撤销。应设置合理的过期时间，避免长生命周期 Token，推荐： <ul><li><strong>Access Token</strong>：短期有效（几分钟到几小时）。</li><li><strong>Refresh Token</strong>：长期有效（几天到几周），用于获取新的 Access Token。</li><li>可结合短期 Access Token + 服务端黑名单机制，实现即时注销。</li></ul></li><li><strong>不存储敏感信息</strong>：JWT 采用 Base64 编码，任何人都能解码，只能防篡改，不能防泄露，不能依赖 JWT 存储敏感数据。</li><li><strong>使用 HTTPS</strong>：使用 HTTPS 传输 Token，防止被中间人窃取。</li><li><strong>使用安全的存储方式</strong>：建议 HttpOnly Cookie 存储，并设置 <code>Secure</code> 和 <code>SameSite</code>。 不建议使用 localStorage，容易遭到 XSS 攻击。</li></ol><h2 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料"><span>参考资料</span></a></h2><ul><li><a href="https://www.geeksforgeeks.org/web-tech/json-web-token-jwt/" target="_blank" rel="noopener noreferrer">JSON Web Token (JWT) | GeeksforGeeks</a></li><li><a href="https://www.rfc-editor.org/rfc/rfc7519" target="_blank" rel="noopener noreferrer">RFC 7519</a></li></ul>`,16))])}const o=e(k,[["render",p]]),g=JSON.parse('{"path":"/blog/lef5pil6/","title":"JWT","lang":"zh-CN","frontmatter":{"title":"JWT","createTime":"2025/12/08 13:21:23","permalink":"/blog/lef5pil6/","tags":["Token","身份验证"],"description":"JWT，全称 JSON Web Token，是一种使用加密签名保护的 JSON 数据，定义在 RFC 7519 中。 它通常用于 Web 应用和 API 中，用于验证用户身份，防止未经授权的访问。 与传统服务端 Session 不同，JWT 是无状态的，服务端无需存储会话信息，因此非常适合分布式系统和微服务架构。 JWT 的结构 JWT 主要由三部分构...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"JWT\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-08T05:34:52.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://sunirein.tech/blog/lef5pil6/"}],["meta",{"property":"og:site_name","content":"SuniRein 的个人小站"}],["meta",{"property":"og:title","content":"JWT"}],["meta",{"property":"og:description","content":"JWT，全称 JSON Web Token，是一种使用加密签名保护的 JSON 数据，定义在 RFC 7519 中。 它通常用于 Web 应用和 API 中，用于验证用户身份，防止未经授权的访问。 与传统服务端 Session 不同，JWT 是无状态的，服务端无需存储会话信息，因此非常适合分布式系统和微服务架构。 JWT 的结构 JWT 主要由三部分构..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-08T05:34:52.000Z"}],["meta",{"property":"article:tag","content":"身份验证"}],["meta",{"property":"article:tag","content":"Token"}],["meta",{"property":"article:modified_time","content":"2025-12-08T05:34:52.000Z"}]]},"readingTime":{"minutes":4.67,"words":1402},"git":{"createdTime":1765172092000,"updatedTime":1765172092000,"contributors":[{"name":"SuniRein","username":"SuniRein","email":"sunirein@qq.com","commits":1,"avatar":"https://avatars.githubusercontent.com/SuniRein?v=4","url":"https://github.com/SuniRein"}]},"autoDesc":true,"filePathRelative":"blog/Web 技术/JWT.md","headers":[],"categoryList":[{"id":"3c8a1d","sort":10005,"name":"Web 技术"}]}');export{o as comp,g as data};
